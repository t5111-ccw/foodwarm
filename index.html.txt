<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒè²¨å“²å­¸å®¶ï¼šä¸€å¥å…¥é­‚å·¥ä½œåŠï¼ˆå¯¦è¸ç‰ˆï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Chosen Palette: Savory Wisdom 2.0 (Deep Teal, Warm Sand, Soft Orange) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'foodie-bg': '#F7F3E8',
                        'foodie-teal': '#115E59',
                        'foodie-orange': '#F97316',
                        'foodie-text': '#1F2937',
                        'foodie-card': '#FFFFFF',
                        'foodie-support': '#FCD34D', /* Yellow/Amber for psychological support */
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'Microsoft JhengHei', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Chart Container Styles as per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Base height */
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Smooth transitions for interactive elements */
        .transition-all-300 {
            transition: all 0.3s ease-in-out;
        }

        .food-btn.active {
            background-color: #115E59;
            color: white;
            border-color: #115E59;
            transform: translateX(5px);
        }
    </style>
</head>
<body class="bg-foodie-bg text-foodie-text font-sans selection:bg-foodie-orange selection:text-white">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-lg border-b border-foodie-teal/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <span class="text-3xl mr-2">ğŸ’¡</span>
                    <h1 class="text-xl font-extrabold text-foodie-teal tracking-wider">
                        åƒè²¨å“²å­¸å®¶
                        <span class="text-foodie-orange text-sm font-normal ml-2">ä¸€å¥å…¥é­‚å·¥ä½œåŠ</span>
                    </h1>
                </div>
                <div class="hidden md:flex space-x-6 text-sm">
                    <a href="#examples" class="text-gray-600 hover:text-foodie-teal transition-colors font-semibold">å…¸ç¯„æ¡ˆä¾‹</a>
                    <a href="#workshop" class="text-foodie-orange hover:text-foodie-teal transition-colors font-bold border-b-2 border-foodie-orange">å¯¦ä½œç…‰é‡‘</a>
                    <a href="#analysis" class="text-gray-600 hover:text-foodie-teal transition-colors font-semibold">è©•åˆ†è§£è®€</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero & Methodology Section -->
    <section id="methodology" class="pt-16 pb-12 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4">
                    å¾å‘³è•¾åˆ°éˆé­‚ï¼š<span class="text-foodie-teal">å‰µä½œæ€è€ƒå››éƒ¨æ›²</span>
                </h2>
                <p class="max-w-3xl mx-auto text-lg text-gray-600">
                    æœ¬èª²ç¨‹æ—¨åœ¨è¨“ç·´æ‚¨å°‡æ—¥å¸¸ç¾é£Ÿçš„**ç‰©ç†ç‰¹å¾µ (A)** è½‰åŒ–ç‚ºå…·å‚™**å¿ƒç†å­¸æ„ç¾©çš„ç™‚ç™’è¯æƒ³ (B)**ï¼Œå†ç¶“ç”±**å®Œæ•´è«–è¿° (C)**ï¼Œæœ€çµ‚**ç²¾ç…‰æˆä¸€å¥ä¸å¸¶èªªæ•™ã€å……æ»¿åŒç†å¿ƒçš„é‡‘å¥ (D)**ã€‚
                </p>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <!-- Step 1 -->
                <div class="bg-foodie-bg p-4 rounded-xl shadow-md border-t-4 border-foodie-teal/50">
                    <div class="text-3xl mb-2 text-foodie-teal">A</div>
                    <h4 class="text-lg font-bold mb-1">æ­¥é©Ÿä¸€ï¼šç‰©ç†ç‰¹å¾µ</h4>
                    <p class="text-xs text-gray-600">è§€å¯Ÿé£Ÿç‰©çš„å½¢ç‹€ã€åšæ³•ã€å£æ„Ÿæˆ–åƒæ³•ã€‚</p>
                </div>

                <!-- Step 2 -->
                 <div class="bg-foodie-bg p-4 rounded-xl shadow-md border-t-4 border-foodie-orange/50">
                    <div class="text-3xl mb-2 text-foodie-orange">B</div>
                    <h4 class="text-lg font-bold mb-1">æ­¥é©ŸäºŒï¼šäººç”Ÿè¯æƒ³</h4>
                    <p class="text-xs text-gray-600">æ€è€ƒ A éš±å«çš„**åŒç†/æ¥ç´/æƒ…ç·’å‡ºå£**ã€‚</p>
                </div>

                <!-- Step 3 (C: Long View/è§€é»ç”¢å‡º) -->
                <div class="bg-foodie-bg p-4 rounded-xl shadow-md border-t-4 border-foodie-teal">
                    <div class="text-3xl mb-2 text-foodie-teal">C</div>
                    <h4 class="text-lg font-bold mb-1">æ­¥é©Ÿä¸‰ï¼šè§€é»ç”¢å‡º</h4>
                    <p class="text-xs text-gray-600">å°‡ Aâ†’B å¯«æˆä¸€å¥**å®Œæ•´çš„**æ€è¾¨å¥ã€‚</p>
                </div>
                
                <!-- Step 4 (D: Final Quote/é‡‘å¥å…¥é­‚) -->
                <div class="bg-foodie-bg p-4 rounded-xl shadow-md border-t-4 border-foodie-orange">
                    <div class="text-3xl mb-2 text-foodie-orange">D</div>
                    <h4 class="text-lg font-bold mb-1">æ­¥é©Ÿå››ï¼šé‡‘å¥å…¥é­‚</h4>
                    <p class="text-xs text-gray-600">å£èªåŒ–ã€ç²¾ç…‰ã€**ä¸å¸¶èªªæ•™**çš„æœ€çµ‚é‡‘å¥ã€‚</p>
                </div>
            
            </div>
        </div>
    </section>

    <!-- Interactive Examples Section -->
    <section id="examples" class="py-16 bg-foodie-bg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-12">
                <h3 class="text-3xl font-bold text-foodie-teal mb-4">å…¸ç¯„æ¡ˆä¾‹è³æ</h3>
                <p class="text-gray-600">
                    ä»¥ä¸‹å±•ç¤ºäº†å…·ç™‚ç™’æ„Ÿçš„ç¯„ä¾‹ã€‚
                </p>
            </div>

            <div class="flex flex-col md:flex-row gap-8">
                <!-- Left Column: Menu Selector -->
                <div class="w-full md:w-1/3 flex flex-col gap-3" id="menu-buttons">
                    <!-- Buttons injected by JS -->
                </div>

                <!-- Right Column: Detail Card -->
                <div class="w-full md:w-2/3">
                    <div id="detail-card" class="bg-white rounded-2xl p-8 border border-foodie-teal/10 shadow-xl h-full flex flex-col justify-between">
                        <div>
                            <div class="flex items-center gap-4 mb-6 border-b pb-4">
                                <span id="detail-icon" class="text-5xl"></span>
                                <div>
                                    <h4 id="detail-title" class="text-2xl font-bold text-gray-900"></h4>
                                    <span id="detail-score" class="inline-block mt-1 bg-foodie-orange text-white text-xs px-3 py-1 rounded-full font-semibold"></span>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">
                                <div class="bg-foodie-bg p-4 rounded-lg border-l-4 border-foodie-teal/70">
                                    <div class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Aï¼šç‰©ç†ç‰¹å¾µ</div>
                                    <div id="detail-feature" class="text-gray-700 font-medium"></div>
                                </div>
                                <div class="bg-foodie-bg p-4 rounded-lg border-l-4 border-foodie-orange/70">
                                    <div class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Bï¼šäººç”Ÿè¯æƒ³ (æ ¸å¿ƒå“²ç†)</div>
                                    <div id="detail-b-association" class="text-gray-700 font-medium"></div>
                                </div>
                            </div>

                            <div class="mb-6 bg-teal-50 p-6 rounded-lg border-2 border-foodie-teal/20">
                                <div class="text-xs font-bold text-foodie-teal uppercase tracking-wider mb-2">Cï¼šå®Œæ•´è«–è¿° (è§€é»ç”¢å‡º)</div>
                                <blockquote class="text-base italic text-gray-700 leading-relaxed">
                                    <span id="detail-c-view"></span>
                                </blockquote>
                            </div>
                            
                            <div class="mb-6 bg-orange-50 p-6 rounded-lg border-2 border-foodie-orange/20">
                                <div class="text-xs font-bold text-foodie-orange uppercase tracking-wider mb-2">Dï¼šæœ€çµ‚é‡‘å¥ (ä¸å¸¶èªªæ•™çš„ç²¾ç…‰)</div>
                                <blockquote class="text-xl italic text-gray-900 leading-relaxed font-bold">
                                    <span id="detail-d-quote"></span>
                                </blockquote>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg mt-4">
                            <div class="text-xs font-bold text-foodie-teal uppercase tracking-wider mb-1">å…¸ç¯„è§£æ (é—œéµæ´å¯Ÿ)</div>
                            <p id="detail-feedback" class="text-sm text-gray-600"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Workshop & Generator Section -->
    <section id="workshop" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-12">
                <h3 class="text-3xl font-bold text-foodie-teal mb-4">ğŸ½ï¸ å“²å­¸å®¶å¯¦ä½œå€ï¼šæ‚¨çš„é‡‘å¥ç…‰é‡‘è¡“ (Aâ†’Bâ†’Câ†’D)</h3>
                <p class="text-gray-600">
                    è«‹ä¾åºå®Œæˆæ‚¨çš„å››å€‹æ€è€ƒæ­¥é©Ÿï¼Œå¾æŠ½è±¡è¯æƒ³åˆ°è§€é»ï¼Œå†åˆ°æ¥µè‡´ç²¾ç…‰ã€‚
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <!-- Left: Workshop Inputs (Four Steps) -->
                <div class="space-y-6">
                     <!-- å­¸ç”Ÿå§“åè¼¸å…¥æ¬„ä½ (åŠ ç²—é‚Šæ¡†ï¼Œæ›´é¡¯çœ¼) -->
                    <div class="bg-foodie-support/20 p-4 rounded-xl border-2 border-foodie-orange/50">
                        <label for="studentName" class="block text-sm font-bold text-foodie-text mb-1">âœï¸ å­¸ç”Ÿå§“å</label>
                        <input type="text" id="studentName" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜ (é€™æ˜¯ç½²åçš„é—œéµå–”ï¼)" class="w-full p-3 border border-foodie-orange/50 rounded-lg focus:ring-foodie-orange focus:border-foodie-orange font-semibold">
                    </div>
                    <div>
                        <label for="foodName" class="block text-sm font-medium text-gray-700 mb-1">1. æ‚¨é¸æ“‡çš„ç¾é£Ÿæ˜¯ä»€éº¼ï¼Ÿ (è«‹å¡«å…¥åç¨±èˆ‡ Emoji)</label>
                        <input type="text" id="foodName" value="ğŸ£æ‰‹æ²" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-foodie-teal focus:border-foodie-teal">
                    </div>

                    <div>
                        <label for="featureA" class="block text-sm font-medium text-gray-700 mb-1">A. æ­¥é©Ÿä¸€ï¼šç‰©ç†ç‰¹å¾µ (A) æè¿°ï¼š(é£Ÿç‰©çš„å½¢ç‹€ã€ä½œæ³•ã€åƒæ³•ã€å£æ„Ÿ)</label>
                        <textarea id="featureA" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-foodie-teal focus:border-foodie-teal">æµ·è‹”å¿…é ˆé¦¬ä¸Šåƒï¼Œæ”¾ä¹…äº†æœƒè»Ÿæ‰ã€‚é£Ÿæå±¤æ¬¡è±å¯Œã€‚</textarea>
                    </div>

                    <div>
                        <label for="associationB" class="block text-sm font-medium text-foodie-orange mb-1">B. æ­¥é©ŸäºŒï¼šäººç”Ÿè¯æƒ³ (B) é—œéµè©ï¼š</label>
                        <textarea id="associationB" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-foodie-orange focus:border-foodie-orange">æŠŠæ¡ç•¶ä¸‹ã€æ™‚æ©Ÿ</textarea>
                    </div>

                    <div class="border-t pt-4 border-foodie-teal/20">
                        <label for="longViewC" class="block text-sm font-medium text-foodie-teal mb-1">
                            C. æ­¥é©Ÿä¸‰ï¼šè§€é»ç”¢å‡º (Aâ†’B å®Œæ•´è«–è¿°)
                            <span class="text-xs text-gray-500 font-normal ml-2"> (å¯«å‡ºæ‚¨çš„å“²ç†é•·ç‰ˆæ€è¾¨å¥)</span>
                        </label>
                        <textarea id="longViewC" rows="3" class="w-full p-3 border border-foodie-teal rounded-lg focus:ring-foodie-teal focus:border-foodie-teal">æµ·è‹”å‰›çƒ¤å¥½æ˜¯è„†çš„ï¼Œå°±åƒäººç”Ÿä¸­çš„æŸäº›æ™‚æ©Ÿï¼ŒéŒ¯éäº†å°±æœƒå¤±å»é¢¨å‘³ã€‚é‡è¦çš„äº‹ï¼Œå¿…é ˆè¶è‘—ã€Œè„†åº¦ã€é‚„åœ¨æ™‚ï¼Œé¦¬ä¸Šè¡Œå‹•ã€‚</textarea>
                    </div>

                    <div class="border-t pt-6 border-foodie-teal/20">
                        <label for="goldenQuote" class="block text-sm font-medium text-foodie-orange mb-1">
                            D. æ­¥é©Ÿå››ï¼šé‡‘å¥å…¥é­‚ (å£èªä¿®é£¾ / æœ€çµ‚äº¤ä»˜ç›®æ¨™) 
                            <span id="wordCountHint" class="text-xs text-red-500 font-normal ml-2"> (ç›®æ¨™ 20 å­—ä»¥å…§ç‚ºæœ€ä½³ | ç›®å‰ï¼š0 å­—)</span>
                        </label>
                        <textarea id="goldenQuote" rows="3" class="w-full p-3 border-2 border-foodie-orange rounded-lg font-bold text-lg focus:ring-foodie-orange focus:border-foodie-orange shadow-md">äººç”Ÿé‡è¦çš„äº‹ï¼Œè¦è¶è‘—æµ·è‹”é‚„è„†æ™‚ï¼Œç«‹åˆ»åšã€‚</textarea>
                    </div>

                    <!-- Scoring Button and Loading Indicator -->
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button id="scoreButton" onclick="scoreQuote()" class="w-full sm:w-2/3 py-3 bg-foodie-orange text-white font-bold rounded-lg shadow-lg hover:bg-orange-600 transition-all-300 disabled:opacity-50 flex items-center justify-center">
                            <svg id="loadingSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            AI æ™ºæ…§è©•åˆ†èˆ‡å»ºè­°
                        </button>
                         <!-- Export History Button -->
                        <button id="exportButton" onclick="exportHistory()" class="w-full sm:w-1/3 py-3 bg-foodie-teal text-white font-bold rounded-lg shadow-lg hover:bg-foodie-teal/90 transition-all-300 disabled:opacity-50 flex items-center justify-center">
                            ğŸ“‚ åŒ¯å‡ºä½œå“æ­·ç¨‹ 
                        </button>
                    </div>
                </div>

                <!-- Right: Golden Sentence Card Preview / Scoring Result -->
                <div class="flex flex-col gap-6">
                    <!-- Preview Card -->
                    <div id="quoteCardPreview" class="w-full max-w-md bg-white p-8 rounded-2xl shadow-2xl border-4 border-foodie-teal/50 relative overflow-hidden transition-all-300">
                        <div class="absolute inset-0 bg-foodie-bg opacity-30 pointer-events-none"></div>
                        <div class="relative z-10">
                            <div class="text-2xl font-bold text-foodie-teal mb-4 border-b pb-2 border-foodie-teal/20" id="cardFoodTitle">ğŸ¿çˆ†ç±³é¦™</div>
                            <blockquote class="text-2xl italic font-serif text-gray-900 mb-6 leading-relaxed">
                                <span class="text-5xl text-foodie-orange opacity-70 mr-1 align-top">â€œ</span>
                                <span id="cardQuoteContent">ç”¨åŠ›çˆ†ï¼Œæ‰æœƒé¦™ã€‚</span>
                            </blockquote>
                            <!-- footer text will be updated by JS -->
                            <div class="text-right text-sm text-gray-500 pt-4 border-t border-foodie-orange/20" id="cardQuoteFooter">
                                â”€â”€ ä¾†è‡ªåƒè²¨å“²å­¸å®¶
                            </div>
                        </div>
                    </div>

                    <!-- Scoring Result Area -->
                    <div id="scoreResultArea" class="bg-white p-6 rounded-2xl shadow-xl border-2 border-foodie-orange/50 hidden">
                        <h4 class="text-xl font-bold text-foodie-orange mb-4 flex justify-between items-center">
                            AI è©•åˆ†å ±å‘Š
                            <span id="finalScore" class="text-3xl font-extrabold text-foodie-teal">--/15</span>
                        </h4>

                        <!-- NEW: Psychological Support Block -->
                        <div class="chart-container mb-6">
                            <canvas id="studentRubricChart"></canvas>
                        </div>
                         <div class="bg-foodie-support/20 p-4 rounded-lg border-2 border-foodie-support mb-6">
                            <div class="text-sm font-bold text-foodie-teal uppercase tracking-wider mb-2 flex items-center gap-2">
                                ğŸ’– æº«æš–æ”¯æŒ (å¿ƒç†è«®è©¢å¸«)
                            </div>
                            <p id="psychologicalSupport" class="text-sm text-gray-700 leading-relaxed italic">AI æ­£åœ¨ç”Ÿæˆæº«æš–æ”¯æŒèª...</p>
                        </div>
                        

                        
                        <div class="bg-foodie-bg p-4 rounded-lg">
                            <div class="text-sm font-bold text-foodie-teal uppercase tracking-wider mb-2">ç²¾é€²å»ºè­° (AI æ•™å¸« / æŠ€è¡“é¢)</div>
                            <p id="aiFeedback" class="text-sm text-gray-700 leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analysis Section (Charts) - Remains the same -->
    <section id="analysis" class="py-16 bg-foodie-bg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-12">
                <h3 class="text-3xl font-bold text-foodie-teal mb-4">ğŸ“ˆ è©•åˆ†ç¶­åº¦èˆ‡æ•¸æ“šè§£è®€ï¼šé‚å‘å“è¶Š</h3>
                <p class="text-gray-600 mb-8">
                    é«˜åˆ†çš„é‡‘å¥å¿…é ˆåŒæ™‚åœ¨ä¸‰å€‹æ ¸å¿ƒç¶­åº¦ä¸Šè¡¨ç¾å‡ºè‰²ã€‚è«‹åƒè€ƒä»¥ä¸‹åœ–è¡¨ï¼Œç†è§£è©•åˆ†å°ºè¦ä¸­ã€Œè¯æƒ³ã€ã€ã€Œè§€é»ã€èˆ‡ã€Œå£èªã€çš„å¹³è¡¡ä¹‹é“ã€‚
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                
                <!-- Chart 1: Rubric Radar Chart (Static Standard) -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h4 class="text-lg font-bold text-gray-800 mb-4 border-l-4 border-foodie-teal pl-3">æ ¸å¿ƒè©•é‡å°ºè¦æ¨¡å‹ (æ»¿åˆ† 5)</h4>
                    <div class="chart-container">
                        <canvas id="rubricChart"></canvas>
                    </div>
                    <div class="mt-4 text-xs text-gray-600">
                        <p>è—è‰²å€åŸŸç‚ºã€Œå“è¶Šã€ï¼ˆ5åˆ†ï¼‰æ¨™æº–ï¼›é»ƒè‰²å€åŸŸç‚ºã€Œé”æ¨™ã€ï¼ˆ3åˆ†ï¼‰æ¨™æº–ã€‚è¿½æ±‚ä¸‰è§’å½¢çš„é£½æ»¿èˆ‡å¹³è¡¡ã€‚</p>
                    </div>
                </div>

                <!-- Chart 2: Example Scores Bar Chart -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h4 class="text-lg font-bold text-gray-800 mb-4 border-l-4 border-foodie-orange pl-3">æ¡ˆä¾‹ç¸½åˆ†æ¯”è¼ƒ (æ»¿åˆ† 15)</h4>
                    <div class="chart-container">
                        <canvas id="scoresChart"></canvas>
                    </div>
                     <div class="mt-4 text-xs text-gray-600">
                        <p>æ‰€æœ‰ç¯„ä¾‹çš†ç‚ºç™‚ç™’å“²å­¸å…¸ç¯„ï¼Œå› åœ¨æ‰€æœ‰ç¶­åº¦ä¸Šçš†é” 5 åˆ†æ¨™æº–ï¼Œæ•…ç²å¾—å…¸ç¯„æ»¿åˆ† (15åˆ†)ã€‚</p>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-foodie-teal text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-2xl font-bold mb-2">åƒè²¨å“²å­¸å®¶</h2>
            <p class="mb-6 opacity-80">æ„Ÿè¬æ‚¨çš„å°ˆæ³¨ã€‚è«‹ç¹¼çºŒç”¨æ–‡å­—æ¢ç´¢ç”Ÿå‘½ã€æ»‹é¤Šå¿ƒéˆã€‚</p>
            <p class="text-xs opacity-60">Â© ä¾†å»è¸…åŸºéš†â€§åœ‹ç«‹åŸºéš†å•†å·¥</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- Global Config and Data ---
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const API_KEY = ""; // Placeholder, handled by Canvas environment
        const MAX_RETRIES = 3;
        const RUBRIC_LABELS = ['è¯æƒ³ç²¾æº–åº¦ (Aâ†’B)', 'è§€é»ç©¿é€åŠ› (A/Bè½‰åŒ–)', 'å£èªç²¾ç…‰åº¦ (Dä¿®é£¾)']; 
        const HISTORY_KEY = 'foodiePhilosopherHistory'; // localStorage key for history

        // æ›´æ–°å¾Œçš„ç¯„ä¾‹è³‡æ–™ï¼Œå…¨éƒ¨ä»¥ 15 åˆ†çš„å…¸ç¯„æ¨™æº–å‘ˆç¾ï¼Œå¼·èª¿ç™‚ç™’èˆ‡åŒç†
        const examplesData = [
            { id: 'pancake', title: 'ğŸ³ è”¥æ²¹é¤…åŠ è›‹', icon: 'ğŸ³', feature: 'å¢åŠ è›‹ç™½è³ªï¼Œç‚ºè‡ªå·±åŠ ä¸€ä»½å¿ƒæ„', b_association: 'è‡ªæˆ‘ç…§é¡§ã€æ„›è‡ªå·±', c_view: 'ä¸€å¡Šé¤…ä¸å¤ ï¼Œå°±å¹«è‡ªå·±åŠ é¡†è›‹ã€‚çœŸæ­£çš„è‡ªæˆ‘è‚¯å®šï¼Œæ˜¯å¾æœ€ç°¡å–®çš„è¡Œå‹•é–‹å§‹çš„ã€‚', d_quote: 'æ—¥å­å†ç°¡å–®ï¼Œä¹Ÿåˆ¥å¿˜äº†å¹«è‡ªå·±ã€ŒåŠ æ–™ã€ã€‚', feedback: 'A(å¢åŠ è›‹ç™½è³ª)â†’B(è‡ªæˆ‘ç…§é¡§)å®Œç¾è½‰åŒ–ã€‚é‡‘å¥å°‡ã€ŒåŠ æ–™ã€ä¸€è©é›™é—œï¼Œå……æ»¿ç™‚ç™’èˆ‡è¡Œå‹•åŠ›ï¼Œæ˜¯å¼·å¤§çš„å¿ƒç†æ”¯æŒã€‚', scores: { accuracy: 5, penetration: 5, refinement: 5, total: 15 } },
            { id: 'chicken', title: 'ğŸ— ç‚¸é›è„–å­', icon: 'ğŸ—', feature: 'è‚‰å¾ˆå°‘ï¼Œéœ€è¦å°ˆæ³¨å•ƒé£Ÿï¼Œäº«å—ç¨ç‰¹çš„éç¨‹', b_association: 'äº«å—éç¨‹ã€å“å‘³ç¨ç‰¹ã€æ¥ç´è‡ªæˆ‘é¸æ“‡', c_view: 'é›–ç„¶è‚‰ä¸å¤šï¼Œä½†å°ˆæ³¨å•ƒçš„éç¨‹æœ¬èº«å°±æ˜¯ä¸€ç¨®äº«å—ã€‚é€™æ˜¯ä¸€ç¨®ä¸»è§€çš„å¿«æ¨‚ï¼Œä¸éœ€è¦è¢«ä»–äººç†è§£ã€‚', d_quote: 'å°±ç®—å…¨ä¸–ç•Œéƒ½å«Œæ£„ï¼Œä½†æˆ‘å°±æ˜¯å–œæ­¡ä½ ã€‚', feedback: 'è§€é»ç›´æŒ‡ã€Œä¸»è§€åƒ¹å€¼ã€èˆ‡ã€Œå°è‡ªæˆ‘é¸æ“‡çš„æ¥ç´ã€ï¼Œçµ¦äºˆè®€è€…å¼·å¤§çš„æƒ…æ„Ÿæ”¯æŒï¼Œå®Œå…¨ä¸å¸¶èªªæ•™ã€‚', scores: { accuracy: 5, penetration: 5, refinement: 5, total: 15 } },
           // { id: 'oyster', title: 'ğŸ¦ª èšµä»”ç…', icon: 'ğŸ¦ª', feature: 'é’èœã€èšµä»”ã€è›‹èˆ‡ç²‰æ¼¿ç³Šæˆä¸€åœ˜çš„æ··äº‚ç‹€æ…‹', b_association: 'æ¥ç´æ··äº‚ã€æ“æŠ±ä¸å®Œç¾', c_view: 'æœ€ç¾å‘³çš„äººç”Ÿï¼Œå¾€å¾€ä¸æ˜¯å½¢ç‹€æœ€å®Œç¾çš„é‚£å€‹ã€‚é‚£äº›çœ‹ä¼¼ã€Œæ··äº‚ã€çš„å…ƒç´ ï¼Œæ­£æ˜¯è®“é¢¨å‘³æ›´è±å¯Œçš„åŸºåº•ã€‚', d_quote: 'äººç”Ÿæ²’å¿…è¦æœ‰æ¨™æº–å½¢ç‹€ï¼Œæ··åœ¨ä¸€èµ·ï¼Œæœ€å°å‘³ã€‚', feedback: 'è¯æƒ³ç²¾æº–æŠ“å–ã€Œæ··äº‚ã€é€£çµã€Œä¸å®Œç¾äººç”Ÿã€ï¼Œè§€é»æ˜¯ã€Œæ¥ç´ç•¶ä¸‹ç‹€æ…‹ã€ï¼Œæä¾›æƒ…ç·’å‡ºå£ï¼Œæ¥µå…·å•Ÿç™¼æ€§ã€‚', scores: { accuracy: 5, penetration: 5, refinement: 5, total: 15 } },
           // { id: 'sourfish', title: 'ğŸŒ¶ï¸ é…¸èœé­š', icon: 'ğŸŒ¶ï¸', feature: 'åˆé…¸åˆè¾£ï¼Œå¿…é ˆå¿å—åˆºæ¿€ï¼Œä¸€é‚Šæµæ±—ä¸€é‚Šäº«å—ï¼Œç—›èˆ‡çˆ½å…±å­˜', b_association: 'è¤‡é›œæƒ…ç·’ã€ç—›ä¸¦å¿«æ¨‚è‘—ã€æˆé•·çš„ä»£åƒ¹', c_view: 'æœ€é›£å¿˜çš„äººç”Ÿç¶“æ­·ï¼Œéƒ½ä¸æ˜¯åªæœ‰å–®ç´”çš„å¿«æ¨‚ã€‚å”¯æœ‰æ¥ç´é‚£ä»½é…¸ã€è¾£çš„åˆºæ¿€ï¼Œæ‰èƒ½é«”é©—åˆ°é­šè‚‰çš„æ¥µè‡´æ»‘é †èˆ‡æ»¿è¶³ã€‚', d_quote: 'äººç”Ÿæœ€æ£’çš„æ»‹å‘³ï¼Œå°±æ˜¯ä¸€é‚Šæµæ·šï¼Œä¸€é‚Šèªªçˆ½ã€‚', feedback: 'æˆåŠŸè½‰åŒ–ã€Œç—›èˆ‡çˆ½ä¸¦å­˜ã€çš„è¤‡é›œå“²ç†ï¼Œç‚ºè®€è€…æä¾›äº†å¼·çƒˆçš„æƒ…ç·’å‡ºå£ï¼Œå…è¨±ä»–å€‘åŒæ™‚æ„Ÿåˆ°ç—›è‹¦èˆ‡æ»¿è¶³ï¼Œç²¾ç…‰åº¦é«˜ã€‚', scores: { accuracy: 5, penetration: 5, refinement: 5, total: 15 } }
            { id: 'fries', title: 'ğŸŸ æ¢…ç”˜åœ°ç“œæ¢', icon: 'ğŸŸ', feature: 'é…¸é¹¹ã€é¦™ç”œ', b_association: 'åå·®ã€é»ç¶´', c_view: 'é…¸é¹¹çš„åå·®å°±åƒç”Ÿæ´»çš„å°æ„å¤–ï¼Œåè€Œèƒ½å‡¸é¡¯å‡ºåŸæœ¬çš„ç”œç¾ã€‚', d_quote: 'ç”Ÿæ´»æœ‰é»å°æ„å¤–ï¼Œåè€Œæ›´ç”œç¾ã€‚', feedback: 'A(é…¸é¹¹)â†’B(åå·®)çš„è¯æƒ³ç²¾æº–ï¼Œä¸¦æˆåŠŸè½‰åŒ–ç‚ºCçš„è§€é»ã€‚ã€Œå°æ„å¤–ã€çš„æ¯”å–»è²¼åˆ‡ï¼Œè®“å¹³å‡¡çš„ã€Œç”œã€æ›´å‡ºè‰²ã€‚', scores: { accuracy: 5, penetration: 4, refinement: 5, total: 14 } },
            { id: 'beef', title: 'ğŸœ ç‰›è‚‰éºµ', icon: 'ğŸœ', feature: 'è‚‰å¤ è±ªé‚å¤§å¡Š', b_association: 'å¯¦åœ¨ã€éç™®', c_view: 'æ–™çµ¦å¾—å¾ˆè¶³æ‰èƒ½çœŸçš„é£½ã€‚', d_quote: 'å°è‡ªå·±å¤§æ–¹ï¼Œå°±æ˜¯æœ€ç´®å¯¦éç™®çš„æ»¿è¶³ã€‚', feedback: 'å¾ã€Œå¤§å¡Šè‚‰ã€è¯æƒ³åˆ°ã€Œå°è‡ªå·±å¤§æ–¹ã€ï¼Œç›´æ¥ä¸”æœ‰åŠ›ã€‚è¯æƒ³ç²¾æº–ä½†è§€é»ç•¥ç‚ºå¸¸è¦‹ï¼Œä½†ç²¾ç…‰åº¦æ¥µé«˜ã€‚', scores: { accuracy: 4, penetration: 4, refinement: 5, total: 13 } }
        
        ];

        let studentRubricChartInstance = null;
        let historyLog = []; // Global array to store history

        // --- UPDATED: The core rubric, focusing heavily on NOT being preachy ---
        const RUBRIC_TEXT = `
            ä½ æ˜¯ä¸€ä½åŒæ™‚å…·å‚™**å°ˆæ¥­åœ‹æ–‡æ•™å¸«çš„åš´è¬¹**èˆ‡**å¿ƒç†è¼”å°å¸«çš„åŒç†å¿ƒ**çš„ AIã€‚
            ä½ çš„ç›®æ¨™æ˜¯æ ¹æ“šä»¥ä¸‹å°ºè¦æä¾›å°ˆæ¥­çš„æŠ€è¡“è©•åˆ†ï¼Œ**éš¨å¾Œå¿…é ˆæä¾›ä¸€å€‹ç¨ç«‹çš„ã€å……æ»¿åŒç†å¿ƒçš„æº«æš–æ”¯æŒæ®µè½**ã€‚

            # è©•é‡å°ºè¦ (æ»¿åˆ† 5 åˆ†/ç¶­åº¦)

            ## 1. è¯æƒ³ç²¾æº–åº¦ (Aâ†’B)
            - 5åˆ† (å“è¶Š): å®Œç¾æŠ“å–é£Ÿç‰©çš„ç¨ç‰¹ç‰©ç†ç‰¹å¾µ(A)æˆ–æƒ…å¢ƒ/å®šä½ï¼Œä¸¦ä»¥æ­¤ä½œç‚ºå“²ç†çš„ã€Œå–»é«”ã€ï¼Œé€£çµäººç”Ÿè¯æƒ³(B)æ–°ç©ã€è²¼åˆ‡ï¼Œå¾å¾®å°ç‰¹å¾µæ´å¯Ÿå‡ºæ·±åˆ»ã€éé¡¯è€Œæ˜“è¦‹çš„ç™‚ç™’å“²ç†ã€‚
            - 3åˆ† (é”æ¨™): Aèˆ‡Bé‚è¼¯é—œè¯æ˜ç¢ºï¼Œèƒ½è¡¨é”ä¸€èˆ¬æ€§çš„æ„Ÿå—æˆ–ç‹€æ…‹ã€‚
            - 1åˆ† (å¾…æ”¹é€²): Aèˆ‡Bé—œè¯è–„å¼±ï¼Œæˆ–è¯æƒ³æµæ–¼è¡¨é¢ä¸”ä¿—å¥—ã€‚

            ## 2. è§€é»ç©¿é€åŠ› (A/B è½‰åŒ– / æ­¥é©Ÿä¸‰)
            - 5åˆ† (å“è¶Š): è§€é»(æ­¥é©Ÿä¸‰ C)èƒ½æä¾›ã€Œé “æ‚Ÿæ„Ÿã€(Aha! moment)ï¼Œå¼•ç™¼å…±é³´ã€ç™‚ç™’äººå¿ƒï¼Œæˆ–æä¾›ã€Œæƒ…ç·’å‡ºå£ã€èˆ‡ã€Œæ–°æ€è€ƒè§’åº¦ã€ã€‚**ï¼ˆçµ•ä¸èƒ½æ˜¯èªªæ•™ã€å‘½ä»¤æˆ–è¦æ±‚ä»–äººåŠªåŠ›çš„èªæ°£ã€‚ï¼‰**
            - 3åˆ† (é”æ¨™): è§€é»(æ­¥é©Ÿä¸‰ C)æ˜¯å¸¸è¦‹çš„å‹µå¿—èªæˆ–å¿ƒå¾—ï¼Œç¼ºä¹å€‹äººç¨ç‰¹è¦‹è§£ã€‚
            - 1åˆ† (å¾…æ”¹é€²): åƒ…ç‚ºAæˆ–Bçš„ç°¡å–®é™³è¿°ï¼Œç„¡è§€é»ã€‚

            ## 3. å£èªç²¾ç…‰åº¦ (Då®šç¨¿ä¿®é£¾ / æ­¥é©Ÿå››)
            --- è©•åˆ†é‚è¼¯ï¼šç›®æ¨™ 20 å­—ä»¥å…§ï¼Œéœ€åŒæ™‚è©•ä¼°å£èªåŒ–ç¨‹åº¦èˆ‡å­—æ•¸ (åŒ…å«æ¨™é»ç¬¦è™Ÿ) ---
            - 5åˆ† (å“è¶Š): 
                1. å¥å­é•·åº¦åš´æ ¼ç¬¦åˆ **20 å­—ä»¥å…§**ã€‚
                2. èªè¨€è¦ªåˆ‡ã€å£èªåŒ–ã€æœ‰ç¯€å¥æ„Ÿï¼Œå¦‚åŒæœ‹å‹èŠå¤©ã€‚ç”¨å­—ç²¾æº–ï¼Œæ…‹åº¦é®®æ˜ï¼Œ**çµ•ä¸å¸¶èªªæ•™æˆ–å‘½ä»¤æ„å‘³**ã€‚
            - 3åˆ† (é”æ¨™):
                1. å¥å­é•·åº¦åœ¨ **21~30 å­—ä¹‹é–“**ã€‚
                2. å¥å‹çµæ§‹å®Œæ•´ï¼Œæ„æ€æ¸…æ™°ï¼Œä¸”å£èªåŒ–ç¨‹åº¦å°šå¯ã€‚
            - 1åˆ† (å¾…æ”¹é€²): 
                1. å¥å­é•·åº¦ **31 å­—ä»¥ä¸Š**ã€‚
                2. èªå¥ä¸é€šé †ï¼Œæˆ–ç”¨å­—ç”Ÿç¡¬ï¼Œæ…‹åº¦å¸¶æœ‰èªªæ•™æ„Ÿã€‚
        `;

        // Function to count Chinese characters (including punctuation)
        function countChineseWords(text) {
            return text.length;
        }

        async function fetchWithRetry(url, payload, retries = MAX_RETRIES) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        return response.json();
                    } else if (response.status === 429 && i < retries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        console.warn(`Rate limit hit. Retrying in ${delay}ms...`);
                    } else {
                        throw new Error(`API request failed with status ${response.status}`);
                    }
                } catch (error) {
                    if (i === retries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    console.error(`Fetch failed. Retrying in ${delay}ms...`);
                }
            }
        }

        async function scoreQuote() {
            const foodName = document.getElementById('foodName').value.trim();
            const featureA = document.getElementById('featureA').value.trim();
            const associationB = document.getElementById('associationB').value.trim();
            const longViewC = document.getElementById('longViewC').value.trim();
            const goldenQuote = document.getElementById('goldenQuote').value.trim();

            if (!foodName || !featureA || !associationB || !longViewC || !goldenQuote) {
                showTemporaryMessage('è«‹å…ˆå¡«å¯«æ‰€æœ‰å››å€‹æ­¥é©Ÿçš„å…§å®¹ï¼Œæ‰èƒ½é€²è¡Œè©•åˆ†ï¼', 'error');
                return;
            }

            const scoreButton = document.getElementById('scoreButton');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const scoreResultArea = document.getElementById('scoreResultArea');
            const psychologicalSupport = document.getElementById('psychologicalSupport');
            
            // Set loading state (FIX: Added null checks)
            if (scoreButton) {
                scoreButton.disabled = true;
                scoreButton.textContent = 'AI æ­£åœ¨åˆ†æä¸­...';
            }
            if (loadingSpinner) {
                loadingSpinner.classList.remove('hidden');
            }
            if (scoreResultArea) {
                scoreResultArea.classList.add('hidden'); // Hide previous result
            }
            // Clear previous support message
            if (psychologicalSupport) {
                 psychologicalSupport.textContent = 'AI æ­£åœ¨ç”Ÿæˆæº«æš–æ”¯æŒèª...';
            }

            const wordCount = countChineseWords(goldenQuote);

            const userQuery = `
                è«‹ä½ æ ¹æ“šæˆ‘æä¾›çš„ã€Œåƒè²¨å“²å­¸å®¶ã€è©•é‡å°ºè¦ï¼Œè©•ä¼°ä»¥ä¸‹å­¸ç”Ÿçš„å‰µä½œï¼š
                
                --- å‰µä½œæµç¨‹èˆ‡å…§å®¹ ---
                ç¾é£Ÿåç¨±: ${foodName}
                æ­¥é©Ÿä¸€ (ç‰©ç†ç‰¹å¾µ A): ${featureA}
                **æ­¥é©ŸäºŒ (äººç”Ÿè¯æƒ³ B):** ${associationB}
                **æ­¥é©Ÿä¸‰ (è§€é»ç”¢å‡º/å®Œæ•´è«–è¿° C):** ${longViewC}  
                **æ­¥é©Ÿå›› (æœ€çµ‚é‡‘å¥/ç²¾ç…‰ D):** ${goldenQuote} 
                ***æ­¥é©Ÿå››çš„é‡‘å¥å­—æ•¸ (åŒ…å«æ¨™é»ç¬¦è™Ÿ): ${wordCount} å­—***

                è«‹ä»¥æ­¥é©Ÿå››çš„ã€Œæœ€çµ‚é‡‘å¥ã€(D) ä½œç‚ºæœ€çµ‚å£èªç²¾ç…‰åº¦çš„è©•åˆ†å°è±¡ã€‚ä½†è«‹åƒè€ƒæ­¥é©Ÿä¸€(A)èˆ‡æ­¥é©ŸäºŒ(B)çš„é—œä¿‚ï¼Œä¾†åˆ¤æ–·ã€Œè¯æƒ³ç²¾æº–åº¦ã€ï¼Œä¸¦åƒè€ƒæ­¥é©Ÿä¸‰(C)ä¾†åˆ¤æ–·ã€Œè§€é»ç©¿é€åŠ›ã€ã€‚**ç‰¹åˆ¥æ³¨æ„ï¼Œè§€é»ç©¿é€åŠ›(2)èˆ‡å£èªç²¾ç…‰åº¦(3)çš„5åˆ†æ¨™æº–ï¼Œéƒ½å¼·èª¿ä¸èƒ½æœ‰èªªæ•™æˆ–å‘½ä»¤æ„å‘³ã€‚**
            `;

            // --- UPDATED JSON SCHEMA for Dual Feedback ---
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: RUBRIC_TEXT }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            scores: {
                                type: "OBJECT",
                                properties: {
                                    accuracy: { type: "INTEGER", description: "è¯æƒ³ç²¾æº–åº¦ (Aâ†’B) 1åˆ°5åˆ†ã€‚" },
                                    penetration: { type: "INTEGER", description: "è§€é»ç©¿é€åŠ› (A/Bè½‰åŒ–ï¼ŒåŸºæ–¼C) 1åˆ°5åˆ†ï¼Œå¿…é ˆè€ƒæ…®æ˜¯å¦æä¾›ç™‚ç™’ã€æƒ…ç·’å‡ºå£ï¼Œä¸”ä¸å¸¶èªªæ•™ã€‚" },
                                    refinement: { type: "INTEGER", description: "å£èªç²¾ç…‰åº¦ (Dä¿®é£¾) 1åˆ°5åˆ†ï¼Œå¿…é ˆåš´æ ¼è€ƒæ…®æ­¥é©Ÿå››é‡‘å¥çš„å­—æ•¸èˆ‡å£èªåŒ–ç¨‹åº¦ï¼Œä¸”ä¸å¸¶èªªæ•™ã€‚" }
                                },
                                required: ["accuracy", "penetration", "refinement"]
                            },
                            totalScore: { type: "INTEGER", description: "ä¸‰å€‹ç¶­åº¦çš„ç¸½åˆ†ï¼Œ1åˆ°15åˆ†ã€‚" },
                            detailedFeedback: { type: "STRING", description: "ä¸€å¥ä¸­æ–‡çš„ã€å…·é«”ã€é¼“å‹µæ€§ä¸”æä¾›æ˜ç¢ºæ”¹é€²æ–¹å‘çš„æŠ€è¡“å»ºè­°ã€‚å¦‚æœå­—æ•¸ä¸ç¬¦åˆ 20 å­—ä»¥å…§çš„è¦æ±‚ï¼Œå¿…é ˆåœ¨å»ºè­°ä¸­æåŠå­—æ•¸å•é¡Œå’Œå°æ‡‰çš„æ‰£åˆ†åŸå› ã€‚" },
                            psychologicalSupport: { type: "STRING", description: "ç¨ç«‹çš„ã€æº«æš–çš„ä¸­æ–‡æ”¯æŒæ®µè½ï¼Œç´„50-80å­—ï¼Œä»¥å¿ƒç†è«®è©¢å¸«çš„è¦ªåˆ‡èªæ°£ï¼Œå°ˆæ³¨æ–¼ä½œå“æ‰€å‚³é”çš„æƒ…ç·’ã€æ…‹åº¦å’Œç™‚ç™’åŠ›ï¼Œä¸æåˆ†æ•¸æˆ–æŠ€è¡“ç´°ç¯€ã€‚" }
                        },
                        required: ["scores", "totalScore", "detailedFeedback", "psychologicalSupport"]
                    }
                }
            };
            
            try {
                const result = await fetchWithRetry(API_URL + API_KEY, payload);

                const jsonText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!jsonText) throw new Error("API response text is empty.");

                const parsedResult = JSON.parse(jsonText);
                renderScore(parsedResult);
                
                // Save to history after successful scoring
                saveHistory(parsedResult);
                showTemporaryMessage('è©•åˆ†æˆåŠŸï¼æœ¬æ¬¡çµæœå·²è‡ªå‹•å„²å­˜åˆ°ä½œå“æ­·ç¨‹ä¸­ã€‚', 'info');

            } catch (error) {
                console.error("Scoring failed:", error);
                if (document.getElementById('aiFeedback')) {
                    document.getElementById('aiFeedback').textContent = 'è©•åˆ†å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¼¸å…¥å…§å®¹å¾Œå†è©¦ä¸€æ¬¡ã€‚éŒ¯èª¤ï¼š' + error.message;
                }
                if (psychologicalSupport) {
                     psychologicalSupport.textContent = 'é€£ç·šéŒ¯èª¤ï¼Œç„¡æ³•ç²å–æ”¯æŒèªã€‚';
                }
                if (scoreResultArea) {
                    scoreResultArea.classList.remove('hidden');
                }
                showTemporaryMessage('è©•åˆ†é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚', 'error');

            } finally {
                // Reset button state
                if (scoreButton) {
                    scoreButton.disabled = false;
                    scoreButton.textContent = 'AI æ™ºæ…§è©•åˆ†èˆ‡å»ºè­°';
                }
                if (loadingSpinner) {
                    loadingSpinner.classList.add('hidden');
                }
            }
        }

        function renderScore(scoreData) {
            const scores = scoreData.scores;
            const totalScore = scoreData.totalScore;
            const feedback = scoreData.detailedFeedback;
            const support = scoreData.psychologicalSupport; // NEW FIELD
            
            // Update UI elements
            document.getElementById('finalScore').textContent = `${totalScore}/15`;
            document.getElementById('aiFeedback').textContent = feedback;
            document.getElementById('psychologicalSupport').textContent = support; // NEW UPDATE
            document.getElementById('scoreResultArea').classList.remove('hidden');

            // Render/Update the student's radar chart
            if (studentRubricChartInstance) {
                studentRubricChartInstance.destroy();
            }

            const ctxStudentRubric = document.getElementById('studentRubricChart').getContext('2d');
            
            studentRubricChartInstance = new Chart(ctxStudentRubric, {
                type: 'radar',
                data: {
                    labels: RUBRIC_LABELS,
                    datasets: [{
                        label: 'æ‚¨çš„åˆ†æ•¸',
                        data: [scores.accuracy, scores.penetration, scores.refinement],
                        fill: true,
                        backgroundColor: 'rgba(249, 115, 22, 0.4)', // Soft Orange
                        borderColor: 'rgb(249, 115, 22)',
                        pointBackgroundColor: 'rgb(249, 115, 22)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(249, 115, 22)'
                    },
                    {
                        label: 'å“è¶Šæ¨™æº– (5åˆ†)',
                        data: [5, 5, 5],
                        fill: false,
                        borderColor: 'rgba(17, 94, 89, 0.5)', // Deep Teal
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: { line: { borderWidth: 3 } },
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 5,
                            ticks: { stepSize: 1, backdropColor: 'transparent' }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                             callbacks: {
                                title: function(tooltipItems) { return tooltipItems[0].label; }
                            }
                        }
                    }
                }
            });
        }

        // --- History and Export Logic ---

        function loadHistory() {
            try {
                const historyString = localStorage.getItem(HISTORY_KEY);
                if (historyString) {
                    historyLog = JSON.parse(historyString);
                }
            } catch (e) {
                console.error("ç„¡æ³•è¼‰å…¥ä½œå“æ­·ç¨‹:", e);
                historyLog = []; // Reset on error
            }
        }

        function saveHistory(scoreData) {
            const timestamp = new Date().toLocaleString('zh-TW', {
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });

            const currentEntry = {
                timestamp: timestamp,
                foodName: document.getElementById('foodName').value.trim(),
                featureA: document.getElementById('featureA').value.trim(),
                associationB: document.getElementById('associationB').value.trim(),
                longViewC: document.getElementById('longViewC').value.trim(),
                goldenQuote: document.getElementById('goldenQuote').value.trim(),
                wordCount: countChineseWords(document.getElementById('goldenQuote').value.trim()),
                score: scoreData.totalScore,
                scoresDetail: scoreData.scores,
                feedback: scoreData.detailedFeedback,
                psychologicalSupport: scoreData.psychologicalSupport // NEW: Save psychological support
            };

            historyLog.push(currentEntry);
            localStorage.setItem(HISTORY_KEY, JSON.stringify(historyLog));
        }

        function exportHistory() {
            if (historyLog.length === 0) {
                showTemporaryMessage('ç›®å‰æ²’æœ‰ä»»ä½•å„²å­˜çš„è©•åˆ†ç´€éŒ„å¯ä¾›åŒ¯å‡ºã€‚', 'error');
                return;
            }
            const currentStudentName = document.getElementById('studentName').value.trim() || 'æœªç½²å';
            //const header = `# åƒè²¨å“²å­¸å®¶ - ä½œå“æ­·ç¨‹åŒ¯å‡ºå ±å‘Š\n\nåŒ¯å‡ºæ™‚é–“: ${new Date().toLocaleString('zh-TW')}\n\n`;
            const header = `# åƒè²¨å“²å­¸å®¶ - ä½œå“æ­·ç¨‹åŒ¯å‡ºå ±å‘Š\n` + 
                   `å­¸ç”Ÿå§“å: ${currentStudentName}\n` + // <-- å­¸ç”Ÿå§“å
                   `åŒ¯å‡ºæ™‚é–“: ${new Date().toLocaleString('zh-TW')}\n\n`; // <-- åŒ¯å‡ºæ™‚é–“
            let content = header;

            historyLog.forEach((entry, index) => {
                const detail = entry.scoresDetail;
                content += `--- ğŸ“ ç¬¬ ${index + 1} æ¬¡å‰µä½œèˆ‡è©•åˆ†ç´€éŒ„ ( ${entry.timestamp} ) ---\n`;
                content += `\n## ${entry.foodName}\n`;
                content += `\n### ğŸ’¡ å‰µä½œæ€è€ƒæ­¥é©Ÿ\n`;
                content += `- **A. ç‰©ç†ç‰¹å¾µ:** ${entry.featureA}\n`;
                content += `- **B. äººç”Ÿè¯æƒ³:** ${entry.associationB}\n`;
                content += `- **C. è§€é»ç”¢å‡º (é•·è«–è¿°):** ${entry.longViewC}\n`;
                content += `- **D. æœ€çµ‚é‡‘å¥ (ç²¾ç…‰):** **ã€Œ${entry.goldenQuote}ã€** (å…± ${entry.wordCount} å­—)\n`;
                content += `\n### ğŸ“Š AI è©•åˆ†å ±å‘Š (ç¸½åˆ†: ${entry.score}/15)\n`;
                content += `- **è¯æƒ³ç²¾æº–åº¦ (Aâ†’B):** ${detail.accuracy} / 5\n`;
                content += `- **è§€é»ç©¿é€åŠ› (A/Bè½‰åŒ–):** ${detail.penetration} / 5\n`;
                content += `- **å£èªç²¾ç…‰åº¦ (Dä¿®é£¾):** ${detail.refinement} / 5\n`;
                content += `\n> **ğŸ’– æº«æš–æ”¯æŒ (å¿ƒç†è«®è©¢å¸«):** ${entry.psychologicalSupport}\n`; // NEW: Include support
                content += `> **ğŸ’¡ æŠ€è¡“å»ºè­° (AI æ•™å¸«):** ${entry.feedback}\n\n`;
            });

            const blob = new Blob([content], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `åƒè²¨å“²å­¸å®¶_ä½œå“æ­·ç¨‹_${new Date().toISOString().slice(0, 10)}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showTemporaryMessage(`æˆåŠŸåŒ¯å‡º ${historyLog.length} ç­†ç´€éŒ„ï¼`, 'info');
        }


        // --- Original JS Logic (Keep unchanged) ---

        // Function to load details
        function loadExample(index) {
            const data = examplesData[index];
            
            // Update UI content
            document.getElementById('detail-icon').textContent = data.icon;
            document.getElementById('detail-title').textContent = data.title.substring(2);
            document.getElementById('detail-score').textContent = `ç¸½åˆ†: ${data.scores.total}/15`;
            document.getElementById('detail-feature').textContent = data.feature;
            document.getElementById('detail-b-association').textContent = data.b_association;
            document.getElementById('detail-c-view').textContent = data.c_view;
            document.getElementById('detail-d-quote').textContent = data.d_quote;
            document.getElementById('detail-feedback').textContent = data.feedback;

            // Update Active Button State
            const buttons = document.querySelectorAll('.food-btn');
            buttons.forEach((btn, i) => {
                if (i === index) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Initialize First Item
        window.onload = function() {
            // Load history from localStorage
            loadHistory(); 

            // Render Buttons
            examplesData.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.className = `food-btn w-full text-left p-4 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all-300 flex items-center gap-3 bg-white group ${index === 0 ? 'active' : ''}`;
                btn.innerHTML = `
                    <span class="text-2xl group-hover:scale-110 transition-transform">${item.icon}</span>
                    <div>
                        <div class="font-bold text-gray-800 group-hover:text-foodie-orange">${item.title.substring(2)}</div>
                        <div class="text-xs text-gray-400">ç¸½åˆ†: ${item.scores.total}/15</div>
                    </div>
                `;
                btn.onclick = () => loadExample(index);
                document.getElementById('menu-buttons').appendChild(btn);
            });
            loadExample(0);
            updateCardPreview();
            initializeStaticCharts();
        };


        // --- Logic: Workshop Generator (Real-Time Preview) ---
        const foodNameInput = document.getElementById('foodName');
        const goldenQuoteInput = document.getElementById('goldenQuote');
        const cardFoodTitle = document.getElementById('cardFoodTitle');
        const cardQuoteContent = document.getElementById('cardQuoteContent');
        const wordCountHint = document.getElementById('wordCountHint');
        const studentNameInput = document.getElementById('studentName');
        const cardQuoteFooter = document.getElementById('cardQuoteFooter')

        function updateCardPreview() {
            // Update text content
            const foodName = foodNameInput.value.trim().substring(0, 15) || 'ç¾é£Ÿåç¨±';
            const quote = goldenQuoteInput.value.trim() || 'è«‹åœ¨é€™è£¡è¼¸å…¥æ‚¨çš„å“²å­¸é‡‘å¥...';
            const studentName = studentNameInput.value.trim();

            cardFoodTitle.textContent = foodName;
            cardQuoteContent.textContent = quote;
            let footerText = 'â”€â”€ ä¾†è‡ªåƒè²¨å“²å­¸å®¶';
               if (studentName) {
              // å¦‚æœå­¸ç”Ÿå§“åæœ‰å¡«å¯«ï¼Œå‰‡åœ¨ã€Œåƒè²¨å“²å­¸å®¶ã€å¾Œæ–¹åŠ ä¸Šå§“å
              footerText += `ãƒ»${studentName}`;
              }
    cardQuoteFooter.textContent = footerText;
            // Update word count hint
            const wordCount = countChineseWords(quote);
            wordCountHint.textContent = `(ç›®æ¨™ 20 å­—ä»¥å…§ | ç›®å‰ï¼š${wordCount} å­—)`;
            
            // Change color based on compliance
            if (wordCount <= 20) {
                wordCountHint.classList.remove('text-red-500', 'text-yellow-600');
                wordCountHint.classList.add('text-foodie-teal');
            } else if (wordCount > 20 && wordCount <= 30) {
                 wordCountHint.classList.remove('text-red-500', 'text-foodie-teal');
                wordCountHint.classList.add('text-yellow-600');
            } else {
                wordCountHint.classList.remove('text-foodie-teal', 'text-yellow-600');
                wordCountHint.classList.add('text-red-500');
            }
        }

        // Function to show temporary message (replaces alert)
        function showTemporaryMessage(message, type = 'info') {
            let color = 'bg-blue-500';
            let icon = 'â„¹ï¸';
            if (type === 'error') {
                color = 'bg-red-500';
                icon = 'âŒ';
            } else if (type === 'info') {
                 color = 'bg-foodie-teal';
                 icon = 'âœ…';
            }


            const container = document.createElement('div');
            container.className = `fixed top-4 right-4 z-[100] p-4 rounded-lg text-white font-bold shadow-xl ${color} transition-opacity duration-300 flex items-center gap-2`;
            container.innerHTML = `<span>${icon}</span> ${message}`;
            document.body.appendChild(container);

            setTimeout(() => {
                container.style.opacity = '0';
                setTimeout(() => container.remove(), 300);
            }, 3000);
        }

        // Attach listeners to update preview on input
        foodNameInput.addEventListener('input', updateCardPreview);
        goldenQuoteInput.addEventListener('input', updateCardPreview);
        studentNameInput.addEventListener('input', updateCardPreview);
        // Also run on load to show initial count
        window.addEventListener('load', updateCardPreview);


        // --- Logic: Charts (Static) ---
        
        // Helper for Chart Labels (Splitting long strings)
        function splitLabel(str, maxLen = 10) {
            if (str.length <= maxLen) return str;
            const words = str.split('');
            const lines = [];
            let currentLine = '';
            words.forEach(char => {
                if ((currentLine + char).length > maxLen) {
                    lines.push(currentLine);
                    currentLine = char;
                } else {
                    currentLine += char;
                }
            });
            lines.push(currentLine);
            return lines;
        }

        function initializeStaticCharts() {
             // Chart 1: Rubric Radar Chart
            const ctxRubric = document.getElementById('rubricChart').getContext('2d');
            new Chart(ctxRubric, {
                type: 'radar',
                data: {
                    labels: RUBRIC_LABELS,
                    datasets: [{
                        label: 'å“è¶Š (5åˆ†æ¨™æº–)',
                        data: [5, 5, 5],
                        fill: true,
                        backgroundColor: 'rgba(17, 94, 89, 0.2)', // Deep Teal
                        borderColor: 'rgb(17, 94, 89)',
                        pointBackgroundColor: 'rgb(17, 94, 89)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(17, 94, 89)'
                    }, {
                        label: 'é”æ¨™ (3åˆ†æ¨™æº–)',
                        data: [3, 3, 3],
                        fill: true,
                        backgroundColor: 'rgba(249, 115, 22, 0.2)', // Orange
                        borderColor: 'rgb(249, 115, 22)',
                        pointBackgroundColor: 'rgb(249, 115, 22)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(249, 115, 22)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: { line: { borderWidth: 3 } },
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 5,
                            ticks: { stepSize: 1, backdropColor: 'transparent' }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) { return tooltipItems[0].label; }
                            }
                        }
                    }
                }
            });

            // Chart 2: Scores Bar Chart
            const ctxScores = document.getElementById('scoresChart').getContext('2d');
            const scoreLabels = examplesData.map(d => d.title);
            const scoreValues = examplesData.map(d => d.scores.total);
            const wrappedScoreLabels = scoreLabels.map(label => splitLabel(label, 6));

            new Chart(ctxScores, {
                type: 'bar',
                data: {
                    labels: wrappedScoreLabels,
                    datasets: [{
                        label: 'ç¸½åˆ† (Total Score)',
                        data: scoreValues,
                        backgroundColor: [
                            'rgba(17, 94, 89, 0.7)',
                            'rgba(17, 94, 89, 0.7)',
                            'rgba(17, 94, 89, 0.7)',
                            'rgba(17, 94, 89, 0.7)'
                        ],
                        borderColor: [
                            'rgb(17, 94, 89)',
                            'rgb(17, 94, 89)',
                            'rgb(17, 94, 89)',
                            'rgb(17, 94, 89)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 16, 
                            title: { display: true, text: 'åˆ†æ•¸ (æ»¿åˆ†15)' }
                        },
                        x: {
                            ticks: { 
                                callback: function(val, index) {
                                    return this.getLabelForValue(val);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                             callbacks: {
                                title: function(tooltipItems) {
                                    return examplesData[tooltipItems[0].dataIndex].title;
                                }
                            }
                        }
                    }
                }
            });
        }

    </script>
</body>
</html>